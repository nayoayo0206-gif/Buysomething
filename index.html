<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ä¼´æ‰‹ç¦®ç´€éŒ„åŠ©æ‰‹</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .loading-overlay { position: fixed; inset: 0; background: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; }
        .loading-overlay.hidden { display: none; }
    </style>
</head>
<body class="bg-slate-100 min-h-screen pb-24 font-sans text-slate-900 select-none">

    <!-- è¼‰å…¥ä¸­é®ç½© -->
    <div id="auth-loading" class="loading-overlay">
        <div class="text-3xl animate-bounce">âœˆï¸</div>
        <div id="status-text" class="font-bold mt-4 text-slate-600">æ­£åœ¨é€£æ¥ Realtime Database...</div>
        <div id="error-log" class="text-red-500 text-xs mt-4 px-10 text-center"></div>
    </div>

    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b">
        <div class="max-w-xl mx-auto px-6 py-4">
            <h1 class="text-xl font-black mb-4">ä¼´æ‰‹ç¦®åŠ©æ‰‹ ğŸ</h1>
            <div class="grid grid-cols-2 gap-3">
                <div class="bg-blue-600 p-4 rounded-2xl text-white shadow-lg shadow-blue-200">
                    <p class="text-[10px] font-bold opacity-80 uppercase">å¾…è²·é ç®— (TWD)</p>
                    <p class="text-xl font-black" id="planned-total">$0</p>
                </div>
                <div class="bg-emerald-500 p-4 rounded-2xl text-white shadow-lg shadow-emerald-200">
                    <p class="text-[10px] font-bold opacity-80 uppercase">å·²èŠ±è²» (TWD)</p>
                    <p class="text-xl font-black" id="purchased-total">$0</p>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-xl mx-auto px-6 pt-6">
        <!-- è¼¸å…¥è¡¨å–® -->
        <section class="mb-8 bg-white p-6 rounded-[2rem] shadow-xl border border-white">
            <div class="space-y-4">
                <div class="grid grid-cols-3 gap-3">
                    <select id="item-currency" class="px-3 py-3 border rounded-xl text-sm bg-slate-50 font-bold outline-none">
                        <option value="TWD">TWD</option>
                        <option value="KRW">KRW</option>
                        <option value="JPY">JPY</option>
                    </select>
                    <input type="text" id="item-name" placeholder="æƒ³è²·ä»€éº¼ï¼Ÿ" class="col-span-2 px-4 py-3 border rounded-xl text-sm outline-none bg-slate-50">
                </div>
                <input type="number" id="item-price" placeholder="é ä¼°åƒ¹æ ¼" class="w-full px-4 py-3 border rounded-xl text-sm bg-slate-50 font-bold">
                <button onclick="addItem()" class="w-full bg-slate-900 text-white font-black py-4 rounded-xl shadow-lg active:scale-95 transition-transform">
                    åŠ å…¥è³¼ç‰©æ¸…å–®
                </button>
            </div>
        </section>

        <!-- æ¸…å–®åˆ—è¡¨ -->
        <div id="items-grid" class="space-y-4"></div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

        // æ‚¨çš„ Firebase é…ç½®
        const firebaseConfig = {
            apiKey: "AIzaSyCjZIN7D-OL99sNhQhcGotEDcWa_7F-x-o",
            authDomain: "tako-4447b.firebaseapp.com",
            projectId: "tako-4447b",
            databaseURL: "https://tako-4447b-default-rtdb.firebaseio.com",
            storageBucket: "tako-4447b.firebasestorage.app",
            messagingSenderId: "804718134895",
            appId: "1:804718134895:web:69e6b15fc6b5f28a512f9a"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // ç™»å…¥ä¸¦åŒæ­¥è³‡æ–™
        signInAnonymously(auth).then(() => {
            const itemsRef = ref(db, 'items');
            onValue(itemsRef, (snapshot) => {
                const data = snapshot.val();
                const itemList = data ? Object.entries(data).map(([id, val]) => ({id, ...val})) : [];
                // æ’åºï¼šæœªè²·çš„åœ¨å‰
                itemList.sort((a, b) => a.bought - b.bought);
                render(itemList);
                document.getElementById('auth-loading').classList.add('hidden');
            });
        }).catch(err => {
            document.getElementById('status-text').innerText = "é€£ç·šå¤±æ•—";
            document.getElementById('error-log').innerText = "éŒ¯èª¤ï¼šè«‹åœ¨ Firebase ä¸­å•Ÿå‹•ã€ŒAuthenticationã€å…§çš„ã€ŒåŒ¿åç™»å…¥ã€ã€‚";
            console.error(err);
        });

        window.addItem = () => {
            const name = document.getElementById('item-name').value.trim();
            const price = parseFloat(document.getElementById('item-price').value) || 0;
            const currency = document.getElementById('item-currency').value;
            if(!name) return;

            push(ref(db, 'items'), {
                name, price, currency,
                bought: false,
                createdAt: Date.now()
            });

            document.getElementById('item-name').value = '';
            document.getElementById('item-price').value = '';
        };

        window.toggleStatus = (id, status) => {
            update(ref(db, 'items/' + id), { bought: !status });
        };

        window.deleteItem = (id) => {
            if(confirm('ç¢ºå®šè¦åˆªé™¤å—ï¼Ÿ')) remove(ref(db, 'items/' + id));
        };

        function render(items) {
            const grid = document.getElementById('items-grid');
            grid.innerHTML = '';
            let p = 0, s = 0;

            items.forEach(item => {
                if(item.bought) s += item.price; else p += item.price;
                
                grid.innerHTML += `
                    <div class="glass-card p-5 rounded-3xl flex justify-between items-center shadow-md border ${item.bought ? 'opacity-50 grayscale' : ''}">
                        <div class="flex-1">
                            <h3 class="font-black text-slate-800">${item.name}</h3>
                            <p class="text-sm font-mono font-bold text-blue-600">${item.currency} ${item.price.toLocaleString()}</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="toggleStatus('${item.id}', ${item.bought})" class="px-5 py-2 rounded-xl text-xs font-black shadow-inner ${item.bought ? 'bg-emerald-100 text-emerald-600' : 'bg-slate-100 text-slate-400'}">
                                ${item.bought ? 'å·²è³¼è²·' : 'å¾…è³¼ä¸­'}
                            </button>
                            <button onclick="deleteItem('${item.id}')" class="text-slate-300 hover:text-red-500 transition-colors">âœ•</button>
                        </div>
                    </div>`;
            });

            document.getElementById('planned-total').innerText = `$${Math.round(p).toLocaleString()}`;
            document.getElementById('purchased-total').innerText = `$${Math.round(s).toLocaleString()}`;
        }
    </script>
</body>
</html>

